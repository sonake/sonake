<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hc.auth.mapper.SysUserMapper">
    <select id="findUserByUsername" parameterType="string" resultType="sysUser">
    SELECT
	u.id,u.username,u.email,u.phone,u. PASSWORD,u. STATUS,u.create_time createTime,
	u.sex,u.dept_id deptId,u.last_login_time lastLoginTime,u.update_time updateTime,u.remark,u.avatar,
	d.dept_name deptName,
	GROUP_CONCAT(r.id) roleId,
	GROUP_CONCAT(r.role_name) roleName
    FROM t_user u
    LEFT JOIN t_dept d ON (u.dept_id = d.id)
    LEFT JOIN t_user_role ur ON (u.id = ur.user_id)
    LEFT JOIN t_role r ON r.id = ur.role_id
    WHERE u.username = #{username}
    GROUP BY u.username,u.id,u.email,u.phone,u. PASSWORD,u. STATUS,u.create_time,u.sex,u.dept_id,u.last_login_time,u.update_time,u.remark,u.avatar
    </select>


    <select id="selectSubDept" resultType="string">
          SELECT
	      GROUP_CONCAT(d.id) subDeptId
          FROM
	      t_dept d
          WHERE
	      d.parent_id = #{deptId}
    </select>
    <select id="selectSubArea" resultType="string">
          SELECT
	      GROUP_CONCAT(a.id) subAreaId
          FROM
	      t_area a
          WHERE
	      a.parent_id = #{areaId}
    </select>
</mapper>
